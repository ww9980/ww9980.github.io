<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="Keywords" content="blog"/>
    <meta name="Description" content="blog"/>
    <title>Simple</title>
    <link rel="shortcut icon" href="/static/favicon.png"/>
    <link rel="stylesheet" type="text/css" href="/main.css" />
</head>
<body>
<div class="main">
    <div class="header">
    	<ul id="pages">
            <li><a href="/">home</a></li>
            <li><a href="/#/tags">tags</a></li>
            <li><a href="/#/archive">archive</a></li>
    	</ul>
    </div>
	<div class="wrap-header">
	<h1>
    <a href="/" id="title"></a>
	</h1>
	</div>
<div id="md" style="display: none;">
<!-- markdown -->
#NAN problem and meshing
`NAN` appears when the floating point error happens, a quick check is to execute `export SCUFF_ABORT_ON_FPE=1` ( set a positive flag on `floating-point exception`). It will cause the program to stop when floating error happens.

A better check would be to check your mesh - if there are any overlapping elements. For example, if you have two boxes sharing a single face, this face has to be a boundary condition face instead of two faces overlapping. 

Another useful debug technique is to set your log file to a more detailed level. Here are the commands from `none` (no log shown on the screen) to `verbose2`(most detailed)
```
export SCUFF_LOGLEVEL="NONE"
export SCUFF_LOGLEVEL="TERSE"
export SCUFF_LOGLEVEL="VERBOSE"
export SCUFF_LOGLEVEL="VERBOSE2"
```

There is a mesh tool called [Neper], an open source polycrystal generation and meshing package. By using `-M` mode, the module meshes polycrystals described by tessellation files. By `-M trap.msh`, the mesh of the geometry is further optimized saving a ton of CPU time. 
#Extended Geometries
When using extruded geometries, you must use an `extrude` command in the `.geo` file instead of meshing it using `gmsh` beforehand(i.e. using a extruded geometry from a CAD design and gmsh it). It's because of the nature of Green Function requires corresponding vertices on the opposite face.

Also, when CPU time is significantly long, you might want to try
`export SCUFF_INTERPOLATION_TOLERANCE=1.0e-3`. Setting the internal tolerance at which BEM matrix elements and scattered fields are computed.  The default value is `1.0e-6`. As quoted from the [official documents]:

`scuff-em` uses `Ewald summation` to accelerate the calculation of the periodic Green's function, but even this accelerated calculation is not fast enough to handle the many millions of evaluations needed to assemble the full BEM matrix. For this reason, when assembling the BEM matrix at a given frequency and Bloch vector, scuff-em first precomputes Ewald-summed values of the periodic DGF at grid points of an interpolation grid, after which values are obtained by interpolation (bypassing Ewald summation). ***The spacing of the grid points is chosen automatically to ensure that the maximum relative error between the interpolated and exact values at any point within the grid boundaries is less than  `SCUFF_INTERPOLATION_TOLERANCE`***.


[official documents]:<http://homerreid.github.io/scuff-em-documentation/applications/GeneralReference/>
[neper]:<neper.sourceforge.net>
<!-- markdown end -->
</div>
<div class="entry" id="main">
<!-- content -->
<h1 id="nanproblemandmeshing">NAN problem and meshing</h1>

<p><code>NAN</code> appears when the floating point error happens, a quick check is to execute <code>export SCUFF_ABORT_ON_FPE=1</code> ( set a positive flag on <code>floating-point exception</code>). It will cause the program to stop when floating error happens.</p>

<p>A better check would be to check your mesh - if there are any overlapping elements. For example, if you have two boxes sharing a single face, this face has to be a boundary condition face instead of two faces overlapping. </p>

<p>Another useful debug technique is to set your log file to a more detailed level. Here are the commands from <code>none</code> (no log shown on the screen) to <code>verbose2</code>(most detailed)</p>

<pre><code>export SCUFF_LOGLEVEL="NONE"
export SCUFF_LOGLEVEL="TERSE"
export SCUFF_LOGLEVEL="VERBOSE"
export SCUFF_LOGLEVEL="VERBOSE2"
</code></pre>

<p>There is a mesh tool called <a href="neper.sourceforge.net">Neper</a>, an open source polycrystal generation and meshing package. By using <code>-M</code> mode, the module meshes polycrystals described by tessellation files. By <code>-M trap.msh</code>, the mesh of the geometry is further optimized saving a ton of CPU time. </p>

<h1 id="extendedgeometries">Extended Geometries</h1>

<p>When using extruded geometries, you must use an <code>extrude</code> command in the <code>.geo</code> file instead of meshing it using <code>gmsh</code> beforehand(i.e. using a extruded geometry from a CAD design and gmsh it). It's because of the nature of Green Function requires corresponding vertices on the opposite face.</p>

<p>Also, when CPU time is significantly long, you might want to try
<code>export SCUFF_INTERPOLATION_TOLERANCE=1.0e-3</code>. Setting the internal tolerance at which BEM matrix elements and scattered fields are computed.  The default value is <code>1.0e-6</code>. As quoted from the <a href="http://homerreid.github.io/scuff-em-documentation/applications/GeneralReference/">official documents</a>:</p>

<p><code>scuff-em</code> uses <code>Ewald summation</code> to accelerate the calculation of the periodic Green's function, but even this accelerated calculation is not fast enough to handle the many millions of evaluations needed to assemble the full BEM matrix. For this reason, when assembling the BEM matrix at a given frequency and Bloch vector, scuff-em first precomputes Ewald-summed values of the periodic DGF at grid points of an interpolation grid, after which values are obtained by interpolation (bypassing Ewald summation). <strong><em>The spacing of the grid points is chosen automatically to ensure that the maximum relative error between the interpolated and exact values at any point within the grid boundaries is less than  <code>SCUFF_INTERPOLATION_TOLERANCE</code></em></strong>.</p>
<!-- content end -->
</div>
<br>
<br>
    <div id="disqus_thread"></div>
	<div class="footer">
		<p>Â© Copyright 2014 by isnowfy, Designed by isnowfy</p>
	</div>
</div>
<script src="main.js"></script>
<script id="content" type="text/mustache">
    <h1>{{title}}</h1>
    <div class="tag">
    {{date}}
    {{#tags}}
    <a href="/#/tag/{{name}}">#{{name}}</a>
    {{/tags}}
    </div>
</script>
<script id="pagesTemplate" type="text/mustache">
    {{#pages}}
    <li>
        <a href="{{path}}">{{title}}</a>
    </li>
    {{/pages}}
</script>
<script>
$(document).ready(function() {
    $.ajax({
        url: "main.json",
        type: "GET",
        dataType: "json",
        success: function(data) {
            $("#title").html(data.name);
            var pagesTemplate = Hogan.compile($("#pagesTemplate").html());
            var pagesHtml = pagesTemplate.render({"pages": data.pages});
            $("#pages").append(pagesHtml);
            //path
            var path = "SCUFF2.html";
            //path end
            var now = 0;
            for (var i = 0; i < data.posts.length; ++i)
                if (path == data.posts[i].path)
                    now = i;
            var post = data.posts[now];
            var tmp = post.tags.split(" ");
            var tags = [];
            for (var i = 0; i < tmp.length; ++i)
                if (tmp[i].length > 0)
                    tags.push({"name": tmp[i]});
            var contentTemplate = Hogan.compile($("#content").html());
            var contentHtml = contentTemplate.render({"title": post.title, "tags": tags, "date": post.date});
            $("#main").prepend(contentHtml);
            if (data.disqus_shortname.length > 0) {
                var disqus_shortname = data.disqus_shortname;
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            }
        }
    });
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ["\\(", "\\)"]], processEscapes: true}});
</script>
</body>
</html>
